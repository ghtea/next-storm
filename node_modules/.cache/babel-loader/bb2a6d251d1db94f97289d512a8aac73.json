{"ast":null,"code":"var _jsxFileName = \"/usr/projects/parallel-storm/src/components/TeamGenerator/Result.js\";\nimport dotenv from 'dotenv';\nimport React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport axios from 'axios';\nimport { NavLink, useParams } from 'react-router-dom';\nimport { connect } from \"react-redux\";\nimport { addResult } from \"../../redux/store\";\nimport readPlanTeam from \"../../redux/thunks/readPlanTeam\";\nimport addRemoveNotification from \"../../redux/thunks/addRemoveNotification\"; // https://reacttraining.com/blog/react-router-v5-1/\n\nimport { Div, Button } from '../../styles/DefaultStyles';\nimport IconLoading from '../../svgs/IconLoading';\nimport IconConfirmed from '../../svgs/IconConfirmed';\nimport IconPending from '../../svgs/IconPending';\nimport IconInfo from '../../svgs/IconInfo';\nimport IconMagic from '../../svgs/basic/IconMagic';\nimport { getRandomSubArray } from '../../tools/vanilla/array';\nconst DivResult = styled(Div)`\n  width: 100%;\n  max-width: 600px;\n  \n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: center;\n  \n  padding-bottom: 10px;\n`;\nconst DivTitle = styled(Div)`\n  margin-top: 10px;\n  font-size: 1.2rem;\n  font-weight: bold;\n  \n  margin-bottom: 10px;\n`;\nconst DivGenerate = styled(Div)`\n  margin-top: 10px;\n  margin-bottom: 10px;\n`;\nconst ButtonMagic = styled(Button)`\n  width: 120px;\n  height: 50px;\n  \n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n  \n  border-radius: 10px;\n  \n  & > div {\n    \n    height: 100%;\n  }\n`;\nconst DivRosterEnter = styled(Div)`\n  \n`;\n\nconst RowPlayer = ({\n  idPlanTeam,\n  battletag,\n  mmr,\n  regions,\n  roles,\n  statusPlayer,\n  isLeader,\n  replacePlayerTags,\n  replacePlayerStatus,\n  addRemoveNotification\n}) => {\n  const regexBattletag = /(#\\d*)$/;\n  const listNumberBattletag = battletag.match(regexBattletag);\n  const battletagNumber = listNumberBattletag[0];\n  const battletagName = battletag.replace(regexBattletag, \"\");\n  return /*#__PURE__*/React.createElement(DivRowPlayer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DivLeader, {\n    onClick: onClick_DivLeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(IconLeader, {\n    width: \"23px\",\n    height: \"18px\",\n    isFilled: isLeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(CopyToClipboard, {\n    text: battletag,\n    onCopy: () => {\n      addRemoveNotification(\"success\", `'${battletag}' has been copied`);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DivBattletag, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(DivBattletagName, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 11\n    }\n  }, \" \", battletagName, \" \"), /*#__PURE__*/React.createElement(DivBattletagNumber, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 11\n    }\n  }, \" \", battletagNumber, \" \"))), /*#__PURE__*/React.createElement(DivRoles, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, \" \", roles.includes(\"Tank\") ? /*#__PURE__*/React.createElement(IconTank, {\n    width: \"20px\",\n    height: \"20px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 42\n    }\n  }) : /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 88\n    }\n  }), \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, \" \", roles.includes(\"Bruiser\") ? /*#__PURE__*/React.createElement(IconBruiser, {\n    width: \"20px\",\n    height: \"20px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 45\n    }\n  }) : /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 94\n    }\n  }), \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, \" \", roles.includes(\"Melee Assassin\") ? /*#__PURE__*/React.createElement(IconMeleeAssassin, {\n    width: \"18px\",\n    height: \"20px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 52\n    }\n  }) : /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 107\n    }\n  }), \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }\n  }, \" \", roles.includes(\"Ranged Assassin\") ? /*#__PURE__*/React.createElement(IconRangedAssassin, {\n    width: \"20px\",\n    height: \"20px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 53\n    }\n  }) : /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 109\n    }\n  }), \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }\n  }, \" \", roles.includes(\"Healer\") ? /*#__PURE__*/React.createElement(IconHealer, {\n    width: \"15px\",\n    height: \"20px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 44\n    }\n  }) : /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 92\n    }\n  }), \" \")), /*#__PURE__*/React.createElement(DivMmr, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }\n  }, mmr), /*#__PURE__*/React.createElement(DivStatus, {\n    onClick: onClick_DivStatus,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }\n  }, IconStatus[statusPlayer]));\n};\n\nconst Result = ({\n  option,\n  listPlayerEntry,\n  addRemoveNotification\n}) => {\n  const [listTeams, setListTeams] = useState([]);\n  const region = option.region;\n  const numberTeamsPlanned = option.numberTeams;\n  const listPlayerBattletag = Object.keys(listPlayerEntry).map(element => listPlayerEntry[element]._id); // list of battletags, this can be modified by .sort\n  // 1. confirmed - 2. leader - 3. less roles player(2, 1) - 4. rest\n\n  const onClick_generateTeams = event => {\n    let numberTeamsResult;\n    let listBattletagPlaying = [];\n    let listBattletagPlayingSorted = []; //  후반에 쓰게될 정렬 함수\n\n    const sortListBattletagByMmrHigherFirst = (battletag1, battletag2) => {\n      // mmr 높은순으로 list of battletags\n      const objPlayer1 = listPlayerEntry.find(objPlayer => objPlayer._id === battletag1);\n      const objPlayer2 = listPlayerEntry.find(objPlayer => objPlayer._id === battletag2);\n      return objPlayer2.mmr.standard[region] - objPlayer1.mmr.standard[region]; // ex 3333, 222, 1111\n    }; // A. 먼저 leader, confirmed  인 것들 고려해서 총 플레이 인원 뽑기\n    // B. 그다음 총 리스트를 leader, 플레이 역할 적은 플레이어, 그외 로 세 개로 나누고, 각각의 3개의 리스트 안에서 mmr 높은 순으로 정렬하고 합치기\n    // C. 정렬된 플레이러들을, (example of 3 teams)\n    // team:  0 1 2    2 1 0   0 1 2    2 1 0  마지막 주기는  mmr 총합 낮은 팀에 mmr 높은 사람 넣는 식으로!\n    // A-1\n\n\n    const listBattletagConfirmed = listPlayerBattletag.filter(battletag => {\n      const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag);\n      return objPlayer.status === \"confirmed\";\n    });\n    const listBattletagConfirmedLeader = listBattletagConfirmed.filter(battletag => {\n      const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag);\n      return objPlayer.tags.includes(\"leader\");\n    });\n    const listBattletagConfirmedNonLeader = listBattletagConfirmed.filter(battletag => {\n      const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag);\n      return !objPlayer.tags.includes(\"leader\");\n    }); //  먼저 설정된 팀 개수 검토\n    // numberTeamsPlanned: 0  means auto \n\n    if (numberTeamsPlanned === 0) {\n      numberTeamsResult = Math.floor(listBattletagConfirmed.length / 5);\n    } else if (listBattletagConfirmed.length < numberTeamsPlanned * 5) {\n      addRemoveNotification(\"error\", \"the number of team which you have set was adjusted\");\n      numberTeamsResult = Math.floor(listBattletagConfirmed.length / 5);\n    } else {\n      numberTeamsResult = numberTeamsPlanned;\n    } // A-2\n\n\n    if (numberTeamsResult === 0) {\n      addRemoveNotification(\"error\", \"need at least 5 confirmed players\");\n    } else if (listBattletagConfirmedLeader.length >= numberTeamsResult * 5) {\n      listBattletagPlaying = getRandomSubArray(listBattletagConfirmedLeader, numberTeamsPlanned * 5);\n    } else {\n      const numberConfirmedLeader = listBattletagConfirmedLeader.length;\n      const listBattletagConfirmedNonLeaderPlaying = getRandomSubArray(listBattletagConfirmedNonLeader, numberTeamsResult * 5 - numberConfirmedLeader);\n      listBattletagPlaying = [...listBattletagConfirmedLeader, ...listBattletagConfirmedNonLeaderPlaying];\n    } //console.log(\"listBattletagPlaying\")\n    //console.log(listBattletagPlaying)\n    // B. 그다음 총 리스트를 leader, 플레이 역할 적은 플레이어, 그외 로 세 개로 나누고, 각각의 3개의 리스트 안에서 mmr 높은 순으로 정렬하고 합치기\n\n\n    let listBattletagPlayingLeader = listBattletagPlaying.filter(battletag => {\n      const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag);\n      return objPlayer.tags.includes(\"leader\");\n    });\n    listBattletagPlayingLeader = listBattletagPlayingLeader.sort((battletag1, battletag2) => sortListBattletagByMmrHigherFirst(battletag1, battletag2));\n    let listBattletagPlayingLessRoles = listBattletagPlaying.filter(battletag => {\n      const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag);\n      return !objPlayer.tags.includes(\"leader\") && objPlayer.roles.length <= 2;\n    });\n    listBattletagPlayingLessRoles = listBattletagPlayingLessRoles.sort((battletag1, battletag2) => sortListBattletagByMmrHigherFirst(battletag1, battletag2));\n    let listBattletagPlayingTheOthers = listBattletagPlaying.filter(battletag => {\n      const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag);\n      return !(objPlayer.roles.length <= 2) && !objPlayer.tags.includes(\"leader\");\n    });\n    listBattletagPlayingTheOthers = listBattletagPlayingTheOthers.sort((battletag1, battletag2) => sortListBattletagByMmrHigherFirst(battletag1, battletag2)); // finally\n\n    listBattletagPlayingSorted = [...listBattletagPlayingLeader, ...listBattletagPlayingLessRoles, ...listBattletagPlayingTheOthers];\n    console.log(`listBattletagPlayingSorted`);\n    console.log(listBattletagPlayingSorted); // C. 정렬된 플레이러들을, (example of 3 teams)\n    // team:  0 1 2    2 1 0   0 1 2    2 1 0  마지막 주기는  mmr 총합 낮은 팀에 mmr 높은 사람 넣는 식으로!\n    //https://stackoverflow.com/questions/3746725/how-to-create-an-array-containing-1-n\n\n    let listIndexTeam = [];\n    const listIncreasing = Array.from(Array(numberTeamsResult), (_, i) => i); // => [0, 1, 2, 3, 4, 5, ...]\n\n    const listDecreasing = Array.from(Array(numberTeamsResult), (_, i) => numberTeamsResult - 1 - i); // => [5, 4, 3, ... ]\n\n    listIndexTeam = [...listIncreasing, ...listDecreasing, ...listIncreasing, ...listDecreasing]; //console.log('listIndexTeam')\n    //console.log(listIndexTeam)\n\n    let listTeamsTemp = new Array(numberTeamsResult);\n\n    for (let i = 0; i < numberTeamsResult; i++) {\n      listTeamsTemp[i] = {};\n      listTeamsTemp[i]['listPlayerBattletag'] = [];\n    }\n\n    for (let iBattletag = 0; iBattletag < listBattletagPlayingSorted.length - numberTeamsResult; iBattletag++) {\n      const cBattletag = listBattletagPlayingSorted[iBattletag];\n      const indexTeamToPush = listIndexTeam[iBattletag];\n      listTeamsTemp[indexTeamToPush]['listPlayerBattletag'].push(cBattletag);\n    }\n\n    console.log(\"listTeamsTemp\");\n    console.log(listTeamsTemp);\n    let listTeamSumOfMmr = Array.from(Array(numberTeamsResult), (_, i) => 0); // numberTeamsResult 개의  0 으로 이루어진 리스트\n\n    let listTeamAverageOfMmr = Array.from(Array(numberTeamsResult), (_, i) => 0); // numberTeamsResult 개의  0 으로 이루어진 리스트\n    //console.log(listTeamSumOfMmr);\n\n    for (let iTeam = 0; iTeam < numberTeamsResult; iTeam++) {\n      for (let iMember = 0; iMember < 4; iMember++) {\n        const cBattletag = listTeamsTemp[iTeam]['listPlayerBattletag'][iMember];\n        const cObjPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === cBattletag);\n        listTeamSumOfMmr[iTeam] += cObjPlayer.mmr.standard[region];\n      }\n    }\n\n    console.log(\"listTeamSumOfMmr\");\n    console.log(listTeamSumOfMmr);\n    let listIndexTeamWhichNeedHighMmrPlayer = [];\n    const listTool = Array.from(Array(numberTeamsResult), (_, i) => i); // [0, 1, 2, ...]\n\n    listIndexTeamWhichNeedHighMmrPlayer = listTool.sort((index1, index2) => {\n      const SumOfMmmr1 = listTeamSumOfMmr[index1];\n      const SumOfMmmr2 = listTeamSumOfMmr[index2];\n      return SumOfMmmr1 - SumOfMmmr2; // 작은게 앞에 나오게 된다.\n    }); // 마지막 인원들 넣기\n\n    for (let jTeam = 0; jTeam < numberTeamsResult; jTeam++) {\n      const cIndexTeam = listIndexTeamWhichNeedHighMmrPlayer[jTeam];\n      const cBattletag = listBattletagPlayingSorted[numberTeamsResult * 4 + jTeam];\n      const cObjPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === cBattletag);\n      listTeamsTemp[cIndexTeam]['listPlayerBattletag'].push(cBattletag);\n      listTeamSumOfMmr[cIndexTeam] += cObjPlayer.mmr.standard[region];\n    } // calculate mmr average\n\n\n    for (let iTeam = 0; iTeam < numberTeamsResult; iTeam++) {\n      listTeamAverageOfMmr[iTeam] = listTeamSumOfMmr[iTeam] / 5;\n    }\n\n    console.log(listTeamsTemp);\n    console.log(\"final average of mmr each team: \");\n    console.log(listTeamAverageOfMmr);\n    setListTeams(listTeamsTemp);\n  };\n\n  return /*#__PURE__*/React.createElement(DivResult, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(DivTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 5\n    }\n  }, \" Result \"), /*#__PURE__*/React.createElement(DivGenerate, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ButtonMagic, {\n    onClick: onClick_generateTeams,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 9\n    }\n  }, \" Generate Teams \"), /*#__PURE__*/React.createElement(IconMagic, {\n    width: \"40px\",\n    height: \"40px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 9\n    }\n  }))), /*#__PURE__*/React.createElement(DivRosterEnter, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 5\n    }\n  }, listTeams.length ? listTeams.map((team, index) => /*#__PURE__*/React.createElement(Div, {\n    key: `team${index}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 11\n    }\n  }, \" \", team.listPlayerBattletag[0], \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 11\n    }\n  }, \" \", team.listPlayerBattletag[1], \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 11\n    }\n  }, \" \", team.listPlayerBattletag[2], \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 11\n    }\n  }, \" \", team.listPlayerBattletag[3], \" \"), /*#__PURE__*/React.createElement(Div, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 11\n    }\n  }, \" \", team.listPlayerBattletag[4], \" \"))) : \"no result yet\"));\n};\n\nfunction mapStateToProps(state) {\n  return {\n    option: state.planTeam.option,\n    listPlayerEntry: state.planTeam.listPlayerEntry //listPlayerEntry: [...state.planTeam.listPlayerEntry]\n    //,workingAddPlayerToListPlayerEntry: state.working.addPlayerToListPlayerEntry\n    //,readyPlanTeam: state.ready.planTeam\n    //,loading: state.loading\n\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    addResult: resultTeam => dispatch(addResult(resultTeam)),\n    addRemoveNotification: (situation, message, time) => dispatch(addRemoveNotification(situation, message, time))\n  };\n} // TableEntry 컴포넌트에서 redux의 state, dispatch 를 일부분 골라서 이용가능하게 된다\n\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Result);","map":{"version":3,"sources":["/usr/projects/parallel-storm/src/components/TeamGenerator/Result.js"],"names":["dotenv","React","useState","useEffect","styled","axios","NavLink","useParams","connect","addResult","readPlanTeam","addRemoveNotification","Div","Button","IconLoading","IconConfirmed","IconPending","IconInfo","IconMagic","getRandomSubArray","DivResult","DivTitle","DivGenerate","ButtonMagic","DivRosterEnter","RowPlayer","idPlanTeam","battletag","mmr","regions","roles","statusPlayer","isLeader","replacePlayerTags","replacePlayerStatus","regexBattletag","listNumberBattletag","match","battletagNumber","battletagName","replace","onClick_DivLeader","includes","onClick_DivStatus","IconStatus","Result","option","listPlayerEntry","listTeams","setListTeams","region","numberTeamsPlanned","numberTeams","listPlayerBattletag","Object","keys","map","element","_id","onClick_generateTeams","event","numberTeamsResult","listBattletagPlaying","listBattletagPlayingSorted","sortListBattletagByMmrHigherFirst","battletag1","battletag2","objPlayer1","find","objPlayer","objPlayer2","standard","listBattletagConfirmed","filter","status","listBattletagConfirmedLeader","tags","listBattletagConfirmedNonLeader","Math","floor","length","numberConfirmedLeader","listBattletagConfirmedNonLeaderPlaying","listBattletagPlayingLeader","sort","listBattletagPlayingLessRoles","listBattletagPlayingTheOthers","console","log","listIndexTeam","listIncreasing","Array","from","_","i","listDecreasing","listTeamsTemp","iBattletag","cBattletag","indexTeamToPush","push","listTeamSumOfMmr","listTeamAverageOfMmr","iTeam","iMember","cObjPlayer","listIndexTeamWhichNeedHighMmrPlayer","listTool","index1","index2","SumOfMmmr1","SumOfMmmr2","jTeam","cIndexTeam","team","index","mapStateToProps","state","planTeam","mapDispatchToProps","dispatch","resultTeam","situation","message","time"],"mappings":"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","sourcesContent":["import dotenv from 'dotenv';\r\nimport React, {useState, useEffect} from 'react';\r\nimport styled from 'styled-components';\r\nimport axios from 'axios';\r\nimport { NavLink, useParams } from 'react-router-dom';\r\n\r\nimport { connect } from \"react-redux\";\r\n\r\nimport {addResult} from \"../../redux/store\";\r\nimport readPlanTeam from \"../../redux/thunks/readPlanTeam\";\r\nimport addRemoveNotification from \"../../redux/thunks/addRemoveNotification\";\r\n// https://reacttraining.com/blog/react-router-v5-1/\r\n\r\nimport {Div, Button} from '../../styles/DefaultStyles';\r\n\r\nimport IconLoading from '../../svgs/IconLoading'\r\n\r\nimport IconConfirmed from '../../svgs/IconConfirmed'\r\nimport IconPending from '../../svgs/IconPending'\r\nimport IconInfo from '../../svgs/IconInfo'\r\nimport IconMagic from  '../../svgs/basic/IconMagic'\r\n\r\nimport {getRandomSubArray} from  '../../tools/vanilla/array'\r\n\r\n\r\nconst DivResult = styled(Div)`\r\n  width: 100%;\r\n  max-width: 600px;\r\n  \r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: flex-start;\r\n  align-items: center;\r\n  \r\n  padding-bottom: 10px;\r\n`;\r\n\r\nconst DivTitle = styled(Div)`\r\n  margin-top: 10px;\r\n  font-size: 1.2rem;\r\n  font-weight: bold;\r\n  \r\n  margin-bottom: 10px;\r\n`\r\n\r\nconst DivGenerate = styled(Div)`\r\n  margin-top: 10px;\r\n  margin-bottom: 10px;\r\n`\r\n\r\nconst ButtonMagic = styled(Button)`\r\n  width: 120px;\r\n  height: 50px;\r\n  \r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  align-items: center;\r\n  \r\n  border-radius: 10px;\r\n  \r\n  & > div {\r\n    \r\n    height: 100%;\r\n  }\r\n`\r\n\r\nconst DivRosterEnter = styled(Div)`\r\n  \r\n`\r\n\r\n\r\n\r\nconst RowPlayer = ({\r\n  idPlanTeam, battletag, mmr, regions, roles, statusPlayer, isLeader\r\n  , replacePlayerTags, replacePlayerStatus, addRemoveNotification\r\n}) => {\r\n  \r\n  \r\n  const regexBattletag = /(#\\d*)$/;\r\n  const listNumberBattletag = battletag.match(regexBattletag);\r\n  \r\n  const battletagNumber = listNumberBattletag[0];\r\n  const battletagName = battletag.replace(regexBattletag, \"\")\r\n  \r\n\r\n  \r\n\r\n  return (\r\n    \r\n    <DivRowPlayer >\r\n      \r\n      <DivLeader onClick={onClick_DivLeader} > \r\n        <IconLeader\r\n          \r\n          width={\"23px\"}\r\n          height={\"18px\"}\r\n          isFilled={isLeader}\r\n        />  \r\n      </DivLeader >\r\n      \r\n      <CopyToClipboard \r\n        text={battletag}\r\n        onCopy={ () => { addRemoveNotification(\"success\", `'${battletag}' has been copied`) } } >\r\n        \r\n        <DivBattletag> \r\n          <DivBattletagName> {battletagName} </DivBattletagName>\r\n          <DivBattletagNumber> {battletagNumber} </DivBattletagNumber>\r\n        </DivBattletag>\r\n        \r\n      </CopyToClipboard>\r\n      \r\n      <DivRoles> \r\n        <Div> {(roles.includes(\"Tank\"))? <IconTank width={\"20px\"} height={\"20px\"} /> : <Div></Div>} </Div>\r\n        <Div> {(roles.includes(\"Bruiser\"))? <IconBruiser width={\"20px\"} height={\"20px\"} /> : <Div></Div>} </Div>\r\n        <Div> {(roles.includes(\"Melee Assassin\"))? <IconMeleeAssassin width={\"18px\"} height={\"20px\"} /> : <Div></Div>} </Div>\r\n        <Div> {(roles.includes(\"Ranged Assassin\"))? <IconRangedAssassin width={\"20px\"} height={\"20px\"} /> : <Div></Div>} </Div>\r\n        <Div> {(roles.includes(\"Healer\"))? <IconHealer width={\"15px\"} height={\"20px\"} /> : <Div></Div>} </Div>\r\n      </DivRoles>\r\n      \r\n      \r\n      <DivMmr> \r\n        {mmr}\r\n      </DivMmr>\r\n       \r\n      <DivStatus onClick={onClick_DivStatus}> \r\n        {IconStatus[statusPlayer]}\r\n      </DivStatus>\r\n        \r\n       \r\n         \r\n    </DivRowPlayer>\r\n  )\r\n}\r\n\r\n\r\n\r\nconst Result = ({\r\n  option, listPlayerEntry\r\n  , addRemoveNotification\r\n}) => {\r\n  \r\n  const [listTeams, setListTeams] = useState([]);\r\n  \r\n  const region = option.region;\r\n  const numberTeamsPlanned = option.numberTeams;\r\n  const listPlayerBattletag = (Object.keys(listPlayerEntry)).map(element=>listPlayerEntry[element]._id); // list of battletags, this can be modified by .sort\r\n  \r\n\r\n  // 1. confirmed - 2. leader - 3. less roles player(2, 1) - 4. rest\r\n  const onClick_generateTeams = (event) => {\r\n    \r\n    let numberTeamsResult;\r\n    let listBattletagPlaying = [];\r\n    let listBattletagPlayingSorted = [];\r\n    \r\n    //  후반에 쓰게될 정렬 함수\r\n    const sortListBattletagByMmrHigherFirst = (battletag1, battletag2) => {    // mmr 높은순으로 list of battletags\r\n      \r\n      const objPlayer1 = listPlayerEntry.find(objPlayer => objPlayer._id === battletag1)\r\n      const objPlayer2 = listPlayerEntry.find(objPlayer => objPlayer._id === battletag2)\r\n      \r\n      return (objPlayer2.mmr.standard[region] - objPlayer1.mmr.standard[region]);\r\n      // ex 3333, 222, 1111\r\n    }\r\n    \r\n    \r\n    // A. 먼저 leader, confirmed  인 것들 고려해서 총 플레이 인원 뽑기\r\n    // B. 그다음 총 리스트를 leader, 플레이 역할 적은 플레이어, 그외 로 세 개로 나누고, 각각의 3개의 리스트 안에서 mmr 높은 순으로 정렬하고 합치기\r\n    // C. 정렬된 플레이러들을, (example of 3 teams)\r\n    // team:  0 1 2    2 1 0   0 1 2    2 1 0  마지막 주기는  mmr 총합 낮은 팀에 mmr 높은 사람 넣는 식으로!\r\n    \r\n    // A-1\r\n    const listBattletagConfirmed = listPlayerBattletag.filter(\r\n      battletag => {\r\n        const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag)\r\n        return ( objPlayer.status === \"confirmed\" )\r\n      }\r\n    )\r\n    \r\n    const listBattletagConfirmedLeader = listBattletagConfirmed.filter(\r\n      battletag => {\r\n        const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag)\r\n        return (objPlayer.tags.includes(\"leader\"))\r\n      }\r\n    )\r\n    \r\n    const listBattletagConfirmedNonLeader = listBattletagConfirmed.filter(\r\n      battletag => {\r\n        const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag)\r\n        return ( !(objPlayer.tags.includes(\"leader\")) )\r\n      }\r\n    )\r\n    \r\n    \r\n    //  먼저 설정된 팀 개수 검토\r\n    \r\n    // numberTeamsPlanned: 0  means auto \r\n    if ( numberTeamsPlanned === 0 ) {\r\n      numberTeamsResult = Math.floor(listBattletagConfirmed.length / 5);\r\n    }\r\n    else if (listBattletagConfirmed.length < (numberTeamsPlanned * 5)) {\r\n      addRemoveNotification(\"error\", \"the number of team which you have set was adjusted\");\r\n      numberTeamsResult = Math.floor(listBattletagConfirmed.length / 5);\r\n    }\r\n    else {numberTeamsResult = numberTeamsPlanned}\r\n    \r\n    \r\n    // A-2\r\n    if (numberTeamsResult === 0) {\r\n      addRemoveNotification(\"error\", \"need at least 5 confirmed players\");\r\n    }\r\n    else if (listBattletagConfirmedLeader.length >= numberTeamsResult * 5 ) {\r\n      listBattletagPlaying = getRandomSubArray(listBattletagConfirmedLeader, numberTeamsPlanned * 5 );\r\n    }\r\n    else {\r\n      const numberConfirmedLeader = listBattletagConfirmedLeader.length;\r\n      const listBattletagConfirmedNonLeaderPlaying = getRandomSubArray(listBattletagConfirmedNonLeader, (numberTeamsResult * 5 - numberConfirmedLeader) );\r\n      listBattletagPlaying = [...listBattletagConfirmedLeader, ...listBattletagConfirmedNonLeaderPlaying];\r\n    }\r\n    \r\n    \r\n    \r\n    //console.log(\"listBattletagPlaying\")\r\n    //console.log(listBattletagPlaying)\r\n    \r\n    // B. 그다음 총 리스트를 leader, 플레이 역할 적은 플레이어, 그외 로 세 개로 나누고, 각각의 3개의 리스트 안에서 mmr 높은 순으로 정렬하고 합치기\r\n    let listBattletagPlayingLeader = listBattletagPlaying.filter(\r\n      battletag => {\r\n        const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag)\r\n        return ( objPlayer.tags.includes(\"leader\") )\r\n      }\r\n    )\r\n    listBattletagPlayingLeader = listBattletagPlayingLeader.sort( (battletag1, battletag2) => sortListBattletagByMmrHigherFirst(battletag1, battletag2) );\r\n    \r\n    \r\n    let listBattletagPlayingLessRoles = listBattletagPlaying.filter(\r\n      battletag => {\r\n        const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag)\r\n        return ( !(objPlayer.tags.includes(\"leader\")) && objPlayer.roles.length <= 2 )\r\n      }\r\n    )\r\n    listBattletagPlayingLessRoles = listBattletagPlayingLessRoles.sort( (battletag1, battletag2) => sortListBattletagByMmrHigherFirst(battletag1, battletag2) );\r\n\r\n   \r\n   let listBattletagPlayingTheOthers = listBattletagPlaying.filter(\r\n      battletag => {\r\n        const objPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === battletag)\r\n        return (  !(objPlayer.roles.length <= 2) && !(objPlayer.tags.includes(\"leader\"))   )\r\n      }\r\n    )\r\n    listBattletagPlayingTheOthers = listBattletagPlayingTheOthers.sort( (battletag1, battletag2) => sortListBattletagByMmrHigherFirst(battletag1, battletag2) );\r\n    \r\n    \r\n    // finally\r\n    listBattletagPlayingSorted = [...listBattletagPlayingLeader, ...listBattletagPlayingLessRoles, ...listBattletagPlayingTheOthers];\r\n    \r\n   console.log(`listBattletagPlayingSorted`) \r\n    console.log(listBattletagPlayingSorted) \r\n    \r\n    \r\n    \r\n   // C. 정렬된 플레이러들을, (example of 3 teams)\r\n   // team:  0 1 2    2 1 0   0 1 2    2 1 0  마지막 주기는  mmr 총합 낮은 팀에 mmr 높은 사람 넣는 식으로!\r\n   \r\n   \r\n   //https://stackoverflow.com/questions/3746725/how-to-create-an-array-containing-1-n\r\n   \r\n   \r\n    let listIndexTeam = [];\r\n   \r\n    const listIncreasing = Array.from(Array(numberTeamsResult), (_, i) => i)  // => [0, 1, 2, 3, 4, 5, ...]\r\n    const listDecreasing = Array.from(Array(numberTeamsResult), (_, i) => ( (numberTeamsResult - 1) - i) ) // => [5, 4, 3, ... ]\r\n\r\n    \r\n    listIndexTeam = [...listIncreasing, ...listDecreasing, ...listIncreasing, ...listDecreasing];\r\n    //console.log('listIndexTeam')\r\n    //console.log(listIndexTeam)\r\n    \r\n    \r\n    \r\n    let listTeamsTemp = new Array(numberTeamsResult);\r\n    for ( let i  =0; i  < numberTeamsResult; i++) {\r\n      listTeamsTemp[i] = {};\r\n      listTeamsTemp[i]['listPlayerBattletag'] = [];\r\n    }\r\n    \r\n    \r\n    \r\n    for ( let iBattletag =0; iBattletag < (listBattletagPlayingSorted.length - numberTeamsResult) ; iBattletag++) {\r\n      \r\n      const cBattletag = listBattletagPlayingSorted[iBattletag];\r\n      const indexTeamToPush = listIndexTeam[iBattletag];\r\n      \r\n      listTeamsTemp[ indexTeamToPush ]['listPlayerBattletag'].push( cBattletag );\r\n    }\r\n    \r\n    console.log(\"listTeamsTemp\")\r\n    console.log(listTeamsTemp)\r\n    \r\n    \r\n    let listTeamSumOfMmr =  Array.from(Array(numberTeamsResult), (_, i) => 0);  // numberTeamsResult 개의  0 으로 이루어진 리스트\r\n    let listTeamAverageOfMmr =  Array.from(Array(numberTeamsResult), (_, i) => 0);  // numberTeamsResult 개의  0 으로 이루어진 리스트\r\n    //console.log(listTeamSumOfMmr);\r\n    \r\n    for ( let iTeam =0; iTeam < numberTeamsResult; iTeam++) {\r\n      \r\n      for ( let iMember =0; iMember < 4; iMember++) {\r\n        \r\n        const cBattletag = listTeamsTemp[iTeam]['listPlayerBattletag'][iMember];\r\n        const cObjPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === cBattletag);\r\n        \r\n        listTeamSumOfMmr[iTeam] += cObjPlayer.mmr.standard[region];\r\n      }\r\n      \r\n    }\r\n    \r\n    console.log(\"listTeamSumOfMmr\")\r\n    console.log(listTeamSumOfMmr)\r\n    \r\n    let listIndexTeamWhichNeedHighMmrPlayer = [];\r\n    const listTool = Array.from(Array(numberTeamsResult), (_, i) => i); // [0, 1, 2, ...]\r\n    listIndexTeamWhichNeedHighMmrPlayer = listTool.sort( (index1, index2) => {\r\n      \r\n      const SumOfMmmr1 = listTeamSumOfMmr[index1];\r\n      const SumOfMmmr2 = listTeamSumOfMmr[index2];\r\n      \r\n      return (SumOfMmmr1 - SumOfMmmr2);  // 작은게 앞에 나오게 된다.\r\n    } )\r\n    \r\n    \r\n    // 마지막 인원들 넣기\r\n    for ( let jTeam =0; jTeam < numberTeamsResult; jTeam++) {\r\n      \r\n      const cIndexTeam = listIndexTeamWhichNeedHighMmrPlayer[jTeam];\r\n      const cBattletag = listBattletagPlayingSorted[numberTeamsResult * 4 + jTeam];\r\n      const cObjPlayer = listPlayerEntry.find(objPlayer => objPlayer._id === cBattletag);\r\n\r\n      (listTeamsTemp[cIndexTeam]['listPlayerBattletag']).push(cBattletag);\r\n      \r\n      listTeamSumOfMmr[cIndexTeam] += cObjPlayer.mmr.standard[region];\r\n    }\r\n    \r\n    // calculate mmr average\r\n    for ( let iTeam =0; iTeam < numberTeamsResult; iTeam++) {\r\n      \r\n      listTeamAverageOfMmr[iTeam] = listTeamSumOfMmr[iTeam] / 5\r\n      \r\n    }\r\n    \r\n    console.log(listTeamsTemp);\r\n    \r\n    console.log(\"final average of mmr each team: \")\r\n    console.log(listTeamAverageOfMmr)\r\n\r\n    setListTeams(listTeamsTemp);\r\n  }\r\n  \r\n  \r\n  return (\r\n  \r\n  <DivResult>\r\n    \r\n    <DivTitle> Result </DivTitle>\r\n    \r\n    \r\n    <DivGenerate>\r\n    \r\n      <ButtonMagic onClick={onClick_generateTeams}>\r\n        <Div> Generate Teams </Div>\r\n        <IconMagic width={\"40px\"} height={\"40px\"} />   \r\n      </ButtonMagic>\r\n    \r\n    </DivGenerate>\r\n  \r\n    <DivRosterEnter>\r\n     {(listTeams.length)?\r\n      \r\n      listTeams.map( (team, index)=>\r\n        <Div key={`team${index}`} > \r\n          <Div> {team.listPlayerBattletag[0]} </Div>\r\n          <Div> {team.listPlayerBattletag[1]} </Div>\r\n          <Div> {team.listPlayerBattletag[2]} </Div>\r\n          <Div> {team.listPlayerBattletag[3]} </Div>\r\n          <Div> {team.listPlayerBattletag[4]} </Div>\r\n        </Div>\r\n      )\r\n     \r\n     : \"no result yet\"}\r\n    </DivRosterEnter>\r\n    \r\n  </DivResult>\r\n    \r\n  )\r\n}\r\n\r\n\r\n\r\n\r\nfunction mapStateToProps(state) { \r\n  return { \r\n    option: state.planTeam.option\r\n    ,listPlayerEntry: state.planTeam.listPlayerEntry\r\n    //listPlayerEntry: [...state.planTeam.listPlayerEntry]\r\n    //,workingAddPlayerToListPlayerEntry: state.working.addPlayerToListPlayerEntry\r\n    //,readyPlanTeam: state.ready.planTeam\r\n    //,loading: state.loading\r\n  }; \r\n} \r\n\r\nfunction mapDispatchToProps(dispatch) { \r\n  return { \r\n    addResult: (resultTeam) => dispatch( addResult(resultTeam) ) \r\n    ,  addRemoveNotification: (situation, message, time) => dispatch( addRemoveNotification(situation, message, time) )\r\n  }; \r\n}\r\n\r\n\r\n// TableEntry 컴포넌트에서 redux의 state, dispatch 를 일부분 골라서 이용가능하게 된다\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Result);"]},"metadata":{},"sourceType":"module"}